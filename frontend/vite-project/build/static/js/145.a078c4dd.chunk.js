"use strict";(self.webpackChunkchat=self.webpackChunkchat||[]).push([[145],{79145:(e,t,n)=>{n.r(t),n.d(t,{Conversation:()=>V,default:()=>X});var i=n(96446),s=n(88911),o=n(65043),r=n(26240),a=n(31802),c=n(34535),l=n(98780),d=n(81045),u=n(85865),h=n(39336),p=n(17392),x=n(39778),g=n(56258),m=n(37970),A=n(89453),b=n(93252),j=n(63326),f=n(79456),v=n(11498),k=n(61358),w=n(70579);const y=(0,c.Ay)(l.A)((e=>{let{theme:t}=e;return{"& .MuiBadge-badge":{backgroundColor:"#44b700",color:"#44b700",boxShadow:"0 0 0 2px ".concat(t.palette.background.paper),"&::after":{position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:"50%",animation:"ripple 1.2s infinite ease-in-out",border:"1px solid currentColor",content:'""'}},"@keyframes ripple":{"0%":{transform:"scale(.8)",opacity:1},"100%":{transform:"scale(2.4)",opacity:0}}}})),C=[{title:"Block this user",action:"block"}],S=()=>{const e=(0,f.wA)(),t=(0,b.A)("between","md","xs","sm"),n=(0,r.A)(),{conversationsList:a,currentConversationId:c}=(0,f.d4)((e=>e.conversation)),{user_id:l}=(0,f.d4)((e=>e.auth)),[S,I]=o.useState(null),B=Boolean(S),F=()=>{I(null)};return(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(i.A,{p:2,width:"100%",sx:{backgroundColor:"light"===n.palette.mode?"#F8FAFF":n.palette.background,boxShadow:"0px 0px 2px rgba(0, 0, 0, 0.25)"},children:(0,w.jsxs)(s.A,{alignItems:"center",direction:"row",sx:{width:"100%",height:"100%"},justifyContent:"space-between",children:[(0,w.jsxs)(s.A,{onClick:()=>{e((0,j.fy)())},spacing:2,direction:"row",children:[(0,w.jsx)(i.A,{children:(0,w.jsx)(y,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"dot",children:(0,w.jsx)(d.A,{alt:a.find((e=>e._id===c)).members[0].displayName,src:""})})}),(0,w.jsxs)(s.A,{spacing:.2,children:[(0,w.jsx)(u.A,{variant:"subtitle2",children:a.find((e=>e._id===c)).members[0].displayName}),(0,w.jsx)(u.A,{variant:"caption",children:"Online"})]})]}),(0,w.jsxs)(s.A,{direction:"row",alignItems:"center",spacing:t?1:3,children:[(0,w.jsx)(h.A,{orientation:"vertical",flexItem:!0}),(0,w.jsx)(p.A,{id:"conversation-positioned-button","aria-controls":B?"conversation-positioned-menu":void 0,"aria-haspopup":"true","aria-expanded":B?"true":void 0,onClick:e=>{I(e.currentTarget)},children:(0,w.jsx)(A.A,{})}),(0,w.jsx)(x.A,{MenuListProps:{"aria-labelledby":"fade-button"},TransitionComponent:g.A,id:"conversation-positioned-menu","aria-labelledby":"conversation-positioned-button",anchorEl:S,open:B,onClose:F,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:(0,w.jsx)(i.A,{p:1,children:(0,w.jsx)(s.A,{spacing:1,children:C.map((t=>(0,w.jsxs)(m.A,{onClick:()=>{F(),"block"===t.action&&(async()=>{const t=l,n=new URLSearchParams({convID:c,status:t});try{const i=await v.A.post("/blockStatus",n);console.log("Block status updated successfully:",i.data),e((0,k.Lq)(c,t))}catch(i){console.error("Error updating block status:",i)}})()},children:[(0,w.jsx)(s.A,{sx:{minWidth:100},direction:"row",alignItems:"center",justifyContent:"space-between",children:(0,w.jsx)("span",{children:t.title})})," "]},t.title)))})})})]})]})})})};var I=n(20906),B=n(51787),F=n(78977),P=n(27193),T=n(73381),R=n(70410),_=n(51842),E=n(45453);const M=(0,c.Ay)(I.A)((e=>{let{theme:t}=e;return{"& .MuiInputBase-input":{paddingTop:"12px !important",paddingBottom:"12px !important"}}})),z=e=>{let{openPicker:t,setOpenPicker:n,setValue:i,value:o,inputRef:r}=e;return(0,w.jsx)(M,{inputRef:r,value:o,onChange:e=>{i(e.target.value)},fullWidth:!0,placeholder:"Write a message...",variant:"filled",InputProps:{disableUnderline:!0,startAdornment:(0,w.jsx)(s.A,{sx:{width:"max-content"},children:(0,w.jsx)(s.A,{sx:{position:"relative",display:"inline-block"}})}),endAdornment:(0,w.jsx)(s.A,{sx:{position:"relative"},children:(0,w.jsx)(B.A,{children:(0,w.jsx)(p.A,{onClick:()=>{n(!t)},children:(0,w.jsx)(P.A,{})})})})}})},L=()=>{const e=(0,r.A)(),t=(0,f.wA)(),{conversationsList:n,currentConversationId:a}=(0,f.d4)((e=>e.conversation)),c=n.find((e=>e._id===a)),l=window.localStorage.getItem("user_id"),d=(0,b.A)("between","md","xs","sm"),{sideBar:h}=(0,f.d4)((e=>e.app)),[x,g]=o.useState(!1),[m,A]=(0,o.useState)(""),j=(0,o.useRef)(null);const y=c.blockStatus===l,C=""!==c.blockStatus&&c.blockStatus!==l;return(0,w.jsx)(i.A,{sx:{position:"relative",backgroundColor:"transparent !important"},children:(0,w.jsx)(i.A,{p:d?1:2,width:"100%",sx:{backgroundColor:"light"===e.palette.mode?"#F8FAFF":e.palette.background,boxShadow:"0px 0px 2px rgba(0, 0, 0, 0.25)"},children:y?(0,w.jsxs)(s.A,{alignItems:"center",spacing:2,children:[(0,w.jsx)(u.A,{children:"B\u1ea1n \u0111\xe3 ch\u1eb7n ng\u01b0\u1eddi d\xf9ng n\xe0y v\xe0 kh\xf4ng th\u1ec3 g\u1eedi hay nh\u1eadn tin nh\u1eafn \u0111\u1ebfn h\u1ecd"}),(0,w.jsx)(F.A,{variant:"contained",color:"secondary",onClick:()=>(async e=>{try{const n=new URLSearchParams({convID:a,status:e}),i=await v.A.post("/blockStatus",n);console.log("Block status updated successfully:",i.data),t((0,k.Lq)(a,e))}catch(n){console.error("Error updating block status:",n)}})(""),children:"B\u1ecf ch\u1eb7n"})]}):C?(0,w.jsx)(u.A,{children:"B\u1ea1n \u0111\xe3 b\u1ecb ng\u01b0\u1eddi d\xf9ng n\xe0y ch\u1eb7n v\xe0 kh\xf4ng th\u1ec3 g\u1eedi hay nh\u1eadn tin nh\u1eafn \u0111\u1ebfn h\u1ecd"}):(0,w.jsxs)(s.A,{direction:"row",alignItems:"center",spacing:d?1:3,children:[(0,w.jsxs)(s.A,{sx:{width:"100%"},children:[(0,w.jsx)(i.A,{style:{zIndex:10,position:"fixed",display:x?"inline":"none",bottom:81,right:d?20:h.open?420:100},children:(0,w.jsx)(_.A,{theme:e.palette.mode,data:R,onEmojiSelect:e=>{!function(e){const t=j.current;if(t){const n=t.selectionStart,i=t.selectionEnd;A(m.substring(0,n)+e+m.substring(i)),t.selectionStart=t.selectionEnd=n+1}}(e.native)}})}),(0,w.jsx)(z,{inputRef:j,value:m,setValue:A,openPicker:x,setOpenPicker:g})]}),(0,w.jsx)(i.A,{sx:{height:48,width:48,backgroundColor:e.palette.primary.main,borderRadius:1.5},children:(0,w.jsx)(s.A,{sx:{height:"100%"},alignItems:"center",justifyContent:"center",children:(0,w.jsx)(p.A,{onClick:()=>{const e=n.find((e=>e._id===a)).members[0]._id,i={conversation:a,sender:l,receiver:e,sentTime:(new Date).toISOString(),content:m};E.sZ.emit("sendMsg",i),t((0,k.o5)({message:i})),t((0,k.zQ)({message:i})),A(""),t((0,k.AG)(i))},children:(0,w.jsx)(T.A,{color:"#ffffff"})})})})]})})})};var O=n(86252),D=n(46560),H=n(79206),G=n(78369),N=n(90310),U=n(83540),W=n(29962);n(57818),n(80675);const Z=()=>{const[e,t]=o.useState(null),n=Boolean(e),i=()=>{t(null)};return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(U.A,{size:20,id:"basic-button","aria-controls":n?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":n?"true":void 0,onClick:e=>{t(e.currentTarget)}}),(0,w.jsx)(x.A,{id:"basic-menu",anchorEl:e,open:n,onClose:i,MenuListProps:{"aria-labelledby":"basic-button"},children:(0,w.jsx)(s.A,{spacing:1,px:1,children:W.zB.map((e=>(0,w.jsx)(m.A,{onClick:i,children:e.title},e.title)))})})]})},q=e=>{let{content:t,sentTime:n,incoming:o,menu:a}=e;const c=(0,r.A)();return(0,w.jsxs)(s.A,{direction:"column",children:[(0,w.jsxs)(s.A,{direction:"row",justifyContent:o?"start":"end",children:[(0,w.jsx)(i.A,{px:1.5,py:1.5,sx:{backgroundColor:o?(0,N.X4)(c.palette.background.default,1):c.palette.primary.main,borderRadius:1.5,width:"max-content"},children:(0,w.jsx)(u.A,{variant:"body2",color:o?c.palette.text:"#fff",children:t})}),a&&(0,w.jsx)(Z,{})]}),(0,w.jsx)(i.A,{px:10,py:.5,sx:{width:"100%"},children:(0,w.jsx)(u.A,{variant:"caption",sx:{color:c.palette.text,display:"block",textAlign:o?"left":"right"},children:n})})]})},Q=window.localStorage.getItem("user_id"),V=e=>{let{isMobile:t,menu:n}=e;const{current_messages:o}=(0,f.d4)((e=>e.conversation)),r=e=>{const t=(0,O.H)(e),n=new Date,i=new Date(t.getTime());return(0,D.r)(i,n)?(0,H.GP)(i,"HH:mm",{locale:G.vi}):(0,H.GP)(i,"dd/MM/yyyy",{locale:G.vi})};return(0,w.jsx)(i.A,{p:t?1:3,children:(0,w.jsx)(s.A,{spacing:3,children:o.map(((e,t)=>(0,w.jsx)(q,{content:e.content,incoming:e.sender!==Q,sentTime:r(e.sentTime),menu:n},t)))})})},X=()=>{const e=(0,b.A)("between","md","xs","sm"),t=(0,r.A)(),n=(0,o.useRef)(null),{current_messages:c}=(0,f.d4)((e=>e.conversation)),l=(0,f.wA)();return(0,o.useEffect)((()=>(E.sZ.on("trans-msg",(e=>{l((0,k.o5)({message:e})),l((0,k.zQ)({message:e}))})),()=>{E.sZ.off("trans-msg")})),[l]),(0,o.useEffect)((()=>{n.current.scrollTop=n.current.scrollHeight}),[c]),(0,w.jsxs)(s.A,{height:"100%",maxHeight:"100vh",width:e?"100vw":"auto",children:[(0,w.jsx)(S,{}),(0,w.jsx)(i.A,{ref:n,width:"100%",sx:{position:"relative",flexGrow:1,overflow:"scroll",backgroundColor:"light"===t.palette.mode?"#F0F4FA":t.palette.background,boxShadow:"0px 0px 2px rgba(0, 0, 0, 0.25)"},children:(0,w.jsx)(a.N,{timeout:500,clickOnTrack:!1,children:(0,w.jsx)(V,{menu:!0,isMobile:e})})}),(0,w.jsx)(L,{})]})}}}]);
//# sourceMappingURL=145.a078c4dd.chunk.js.map