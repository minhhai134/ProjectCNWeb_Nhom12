"use strict";(self.webpackChunkchat=self.webpackChunkchat||[]).push([[263],{77263:(e,t,n)=>{n.r(t),n.d(t,{default:()=>D});var r=n(65043),o=n(96446),i=n(88911),s=n(85865),a=n(39336),l=n(96391),c=n(10850),d=new Map;d.set("bold",(function(e){return r.createElement(r.Fragment,null,r.createElement("circle",{cx:"116",cy:"116",r:"84",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"24"}),r.createElement("line",{x1:"175.4",y1:"175.4",x2:"224",y2:"224",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"24"}))})),d.set("duotone",(function(e){return r.createElement(r.Fragment,null,r.createElement("circle",{cx:"116",cy:"116",r:"84",opacity:"0.2"}),r.createElement("circle",{cx:"116",cy:"116",r:"84",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"16"}),r.createElement("line",{x1:"175.4",y1:"175.4",x2:"224",y2:"224",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"16"}))})),d.set("fill",(function(){return r.createElement(r.Fragment,null,r.createElement("path",{d:"M176,116a60,60,0,1,1-60-60A60,60,0,0,1,176,116Zm53.6,113.7A8,8,0,0,1,224,232a8.3,8.3,0,0,1-5.7-2.3l-43.2-43.3a92.2,92.2,0,1,1,11.3-11.3l43.2,43.2A8,8,0,0,1,229.6,229.7ZM116,192a76,76,0,1,0-76-76A76.1,76.1,0,0,0,116,192Z"}))})),d.set("light",(function(e){return r.createElement(r.Fragment,null,r.createElement("circle",{cx:"116",cy:"116",r:"84",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"12"}),r.createElement("line",{x1:"175.4",y1:"175.4",x2:"224",y2:"224",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"12"}))})),d.set("thin",(function(e){return r.createElement(r.Fragment,null,r.createElement("circle",{cx:"116",cy:"116",r:"84",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"8"}),r.createElement("line",{x1:"175.4",y1:"175.4",x2:"224",y2:"224",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"8"}))})),d.set("regular",(function(e){return r.createElement(r.Fragment,null,r.createElement("circle",{cx:"116",cy:"116",r:"84",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"16"}),r.createElement("line",{x1:"175.4",y1:"175.4",x2:"224",y2:"224",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"16"}))}));var u=function(e,t){return(0,l.$)(e,t,d)},h=(0,r.forwardRef)((function(e,t){return r.createElement(c.A,Object.assign({ref:t},e,{renderPath:u}))}));h.displayName="MagnifyingGlass";const p=h;var m=n(31802),g=n(26240),x=n(93252),f=n(17392),v=n(689),k=n(29962),j=n(70579);const y=()=>{const e=(0,g.A)(),[t,n]=r.useState(0);return(0,j.jsx)(o.A,{sx:{zIndex:10,position:"absolute",bottom:0,width:"100vw",backgroundColor:e.palette.background.paper,boxShadow:"0px 0px 2px rgba(0, 0, 0, 0.25)"},children:(0,j.jsxs)(i.A,{sx:{width:"100%"},direction:"row",alignItems:"center",justifyContent:"space-between",spacing:2,p:2,children:[k.Ok.map((r=>r.index===t?(0,j.jsx)(o.A,{sx:{backgroundColor:e.palette.primary.main,borderRadius:1.5},p:1,children:(0,j.jsx)(f.A,{sx:{width:"max-content",color:"#ffffff"},children:r.icon})}):(0,j.jsx)(f.A,{onClick:()=>{var e;e=r.index,n(e)},sx:{width:"max-content",color:"light"===e.palette.mode?"#080707":e.palette.text.primary},children:r.icon}))),(0,j.jsx)(v.A,{})]})})};var A=n(98780),w=n(81045),b=n(34535),C=n(90310),E=n(79456),L=(n(63326),n(61358));const M=(0,b.Ay)(o.A)((e=>{let{theme:t}=e;return{"&:hover":{cursor:"pointer"}}})),S=(0,b.Ay)(A.A)((e=>{let{theme:t}=e;return{"& .MuiBadge-badge":{backgroundColor:"#44b700",color:"#44b700",boxShadow:"0 0 0 2px ".concat(t.palette.background.paper),"&::after":{position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:"50%",animation:"ripple 1.2s infinite ease-in-out",border:"1px solid currentColor",content:'""'}},"@keyframes ripple":{"0%":{transform:"scale(.8)",opacity:1},"100%":{transform:"scale(2.4)",opacity:0}}}})),F=e=>{let{img:t,displayName:n,msg:r,time:o,unread:a,online:l,id:c,isSearching:d,onClick:u}=e;const{currentConversationId:h,isFirstLogin:p}=(0,E.d4)((e=>e.conversation)),m=!p&&h===c,x=(0,g.A)();return(0,j.jsx)(M,{onClick:u,sx:{width:"100%",borderRadius:1,backgroundColor:m?"light"===x.palette.mode?(0,C.X4)(x.palette.primary.main,.5):x.palette.primary.main:"light"===x.palette.mode?"#fff":x.palette.background.paper},p:2,children:(0,j.jsxs)(i.A,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,j.jsxs)(i.A,{direction:"row",spacing:2,children:[l?(0,j.jsx)(S,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"dot",children:(0,j.jsx)(w.A,{alt:n,src:t})}):(0,j.jsx)(w.A,{alt:n,src:t}),(0,j.jsxs)(i.A,{spacing:.3,children:[(0,j.jsx)(s.A,{variant:"subtitle2",children:n}),(0,j.jsx)(s.A,{variant:"caption",children:(f=r,v=20,(null===f||void 0===f?void 0:f.length)>v?"".concat(null===f||void 0===f?void 0:f.slice(0,v),"..."):f)})]})]}),(0,j.jsxs)(i.A,{spacing:2,alignItems:"center",children:[(0,j.jsx)(s.A,{sx:{fontWeight:600},variant:"caption",children:o}),(0,j.jsx)(A.A,{className:"unread-count",color:"primary",badgeContent:a})]})]})});var f,v},H=(0,b.Ay)("div")((e=>{let{theme:t}=e;return{position:"relative",borderRadius:20,backgroundColor:(0,C.X4)(t.palette.background.paper,1),marginRight:t.spacing(2),marginLeft:0,width:"100%"}})),I=(0,b.Ay)("div")((e=>{let{theme:t}=e;return{padding:t.spacing(0,2),height:"100%",position:"absolute",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"}}));var T=n(25673);const W=(0,b.Ay)(T.Ay)((e=>{let{theme:t}=e;return{color:"inherit","& .MuiInputBase-input":{padding:t.spacing(1,1,1,0),paddingLeft:"calc(1em + ".concat(t.spacing(4),")"),width:"100%"}}}));var N=n(45453),R=n(86252),_=n(46560),Z=n(79206),P=n(64),U=n(78369);const D=()=>{const e=(0,g.A)(),t=(0,x.A)("up","md"),n=(0,E.wA)(),{user_id:l}=(0,E.d4)((e=>e.auth)),{conversationsList:c}=(0,E.d4)((e=>e.conversation)),[d,u]=(0,r.useState)(""),[h,f]=(0,r.useState)([]),[v,k]=(0,r.useState)(null),[A,w]=(0,r.useState)(!1);(0,r.useEffect)((()=>{if(l)return(0,N.cH)(l),n((0,L.dU)()),N.sZ.on("trans-msg",(e=>{n((0,L.zQ)({message:e}))})),N.sZ.on("searchUserResult",(e=>{console.log("Search results received:",e),f(e)})),()=>{(0,N.G1)(),N.sZ.off("trans-msg"),N.sZ.off("searchUserResult")}}),[n,l]);const b=e=>{const t=(0,R.H)(e),n=new Date,r=new Date(t.getTime());return(0,_.r)(r,n)?(0,Z.GP)(r,"HH:mm",{locale:U.vi}):(0,Z.GP)(r,"dd/MM/yyyy",{locale:U.vi})};async function C(e,t){try{const n=await fetch(e,t);if(!n.ok){const e=await n.text();throw new Error("Network response was not ok: ".concat(e))}return await n.json()}catch(n){return console.error("Error creating document:",n),null}}const M=c.slice().sort(((e,t)=>{var n,r,o,i;const s=e.latestMessage&&(0,P.f)((0,R.H)(null===(n=e.latestMessage)||void 0===n?void 0:n.sentTime))?(0,R.H)(null===(r=e.latestMessage)||void 0===r?void 0:r.sentTime):e.lastActive&&(0,P.f)((0,R.H)(e.lastActive))?(0,R.H)(e.lastActive):new Date(0);return(t.latestMessage&&(0,P.f)((0,R.H)(null===(o=t.latestMessage)||void 0===o?void 0:o.sentTime))?(0,R.H)(null===(i=t.latestMessage)||void 0===i?void 0:i.sentTime):t.lastActive&&(0,P.f)((0,R.H)(t.lastActive))?(0,R.H)(t.lastActive):new Date(0))-s}));if(v){const e=M.findIndex((e=>e._id===v));if(e>-1){const[t]=M.splice(e,1);M.unshift(t)}}return(0,j.jsx)(j.Fragment,{children:(0,j.jsxs)(o.A,{sx:{position:"relative",height:"100%",width:t?320:"100vw",backgroundColor:"light"===e.palette.mode?"#F8FAFF":e.palette.background,boxShadow:"0px 0px 2px rgba(0, 0, 0, 0.25)"},children:[!t&&(0,j.jsx)(y,{}),(0,j.jsxs)(i.A,{p:3,spacing:2,sx:{maxHeight:"100vh"},children:[(0,j.jsx)(i.A,{alignItems:"center",justifyContent:"space-between",direction:"row",children:(0,j.jsx)(s.A,{variant:"h5",children:"Chats"})}),(0,j.jsx)(i.A,{sx:{width:"100%"},children:(0,j.jsxs)(H,{children:[(0,j.jsx)(I,{children:(0,j.jsx)(p,{color:"#709CE6"})}),(0,j.jsx)(W,{placeholder:"Search\u2026",inputProps:{"aria-label":"search"},value:d,onChange:e=>{const t=e.target.value;if(u(t),t.length>0){const e={userID:l,searchStr:t};N.sZ&&(N.sZ.emit("search_user",e),console.log("Searching for user:",e))}else f([])}})]})}),(0,j.jsx)(a.A,{}),(0,j.jsx)(i.A,{sx:{flexGrow:1,overflow:"scroll",height:"100%"},children:(0,j.jsx)(m.N,{timeout:500,clickOnTrack:!1,children:(0,j.jsxs)(i.A,{spacing:2.4,children:[h.length>0&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(s.A,{variant:"subtitle2",sx:{color:"#676667"},children:"Search Results"}),h.map(((e,t)=>(0,j.jsx)(F,{displayName:e._id===l?"B\u1ea1n":e.displayName,onClick:()=>(async e=>{try{const t="http://localhost:8000/api/conversation",r=[l.toString(),e.toString()];let o=new URLSearchParams;o.append("members",r);const i={method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o.toString()};let s=await C(t,i);if(console.log(s),!s||!s.data||!s.data._id){console.warn("PUT request did not return a valid conversation, attempting to create a new one",s);const e={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o.toString()};if(s=await C(t,e),console.log(s),!s||!s.data||!s.data._id)throw new Error("Failed to create or find conversation.")}const a=s.data._id;n((0,L.eM)({conversationId:a})),k(a),n((0,L.dU)()),u(""),f([])}catch(t){console.error("Error handling search result click:",t)}})(e._id)},t))),(0,j.jsx)(a.A,{})]}),(0,j.jsx)(s.A,{variant:"subtitle2",sx:{color:"#676667"},children:"All Chats"}),M.map(((e,t)=>{var r,o,i,s;return(0,j.jsx)(F,{...e,displayName:e.members[0].displayName,msg:l===(null===(r=e.latestMessage)||void 0===r?void 0:r.sender)?"B\u1ea1n: ".concat(null===(o=e.latestMessage)||void 0===o?void 0:o.content):(null===(i=e.latestMessage)||void 0===i?void 0:i.content)||"No message",time:e.latestMessage?b(null===(s=e.latestMessage)||void 0===s?void 0:s.sentTime)||b(e.lastActive):"",id:e._id,onClick:()=>{n((0,L.eM)({conversationId:e._id})),k()}},t)}))]})})})]})]})})}}}]);
//# sourceMappingURL=263.1cfb4662.chunk.js.map